<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SynthwaveOS → Retro Terminal</title>
  <style>
    body {
      margin:0;
      height:100vh;
      background:black;
      font-family: 'Courier New', monospace;
      overflow:hidden;
      color:#33ff33;
    }

    /* Loading Screen */
    #loadingScreen {
      position:absolute;
      top:0; left:0;
      width:100vw; height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:radial-gradient(circle at bottom, #0f0f1f, #111, #000);
      color:#33ff33;
      font-size:3em;
      text-shadow:0 0 15px #0f0, 0 0 40px #0f0;
      z-index:10;
    }
    #loadingText {
      opacity:0;
      animation: fadeInOut 4s forwards;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Terminal */
    #terminal {
      display:none;
      padding:15px;
      height:100vh;
      width:100vw;
      background:black;
      color:#33ff33;
      font-size:1.1em;
      white-space: pre-wrap;
      overflow-y:auto;
    }
    .input-line { display:flex; margin-top:0.2em; }
    .prompt { margin-right:6px; }
    #commandInput {
      background:none;
      border:none;
      color:#33ff33;
      outline:none;
      font-size:1.1em;
      flex:1;
    }

    /* Shared Page Style */
    .retro-page {
      display:none;
      flex-direction:column;
      justify-content:flex-start;
      align-items:center;
      padding:20px;
      height:100vh;
      width:100vw;
      background:black;
      color:#33ff33;
      font-size:1.1em;
      overflow-y:auto;
    }
    .retro-box {
      border:1px solid #33ff33;
      padding:15px;
      margin:10px 0;
      width:90%;
      max-width:800px;
      background:rgba(0,255,0,0.05);
      border-radius:6px;
    }
    .retro-btn {
      background:none;
      border:1px solid #33ff33;
      color:#33ff33;
      padding:6px 12px;
      cursor:pointer;
      font-family:'Courier New', monospace;
      font-size:1em;
      margin-top:10px;
    }
    .retro-btn:hover {
      background:#33ff33;
      color:black;
    }
    .section-title {
      font-weight:bold;
      text-decoration:underline;
      margin-bottom:10px;
    }

    /* Calendar Inputs */
    .calendar-input {
      display:flex;
      gap:10px;
      margin-bottom:10px;
    }
    .calendar-input input {
      background:black;
      border:1px solid #33ff33;
      color:#33ff33;
      padding:5px;
      font-family:'Courier New', monospace;
    }

    /* Design Page */
    #designPage img {
      width:100%;
      max-width:800px;
      border:1px solid #33ff33;
    }
    #designPage .controls { margin-top:10px; }

    /* Nuclear Simulation */
    #nuclearPage .status { font-family:'Courier New', monospace; }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <div id="loadingText">BOOTING...</div>
  </div>

  <div id="terminal"></div>

  <!-- Design Page -->
  <div id="designPage" class="retro-page">
    <div class="retro-box">
      <div class="section-title">[ INTERIOR VIEWER ]</div>
      <img id="photo" alt="Design photo">
      <div class="controls">
        <button class="retro-btn" id="newBtn">⟳ New</button>
        <button class="retro-btn" onclick="backToTerminal()">← Back</button>
      </div>
    </div>
    <div class="retro-box">
      <div class="section-title">[ SYNTH RADIO ]</div>
      <audio id="radio" controls muted>
        <source src="https://ice3.somafm.com/synphaera-128-mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <div id="timeLeft">Click to start Synphaera Radio</div>
    </div>
  </div>

  <!-- Portal Page -->
  <div id="portalPage" class="retro-page">
    <div class="retro-box">
      <div class="section-title">[ ORGANIZER / CALENDAR ]</div>
      <div class="calendar-input">
        <input type="date" id="eventDate">
        <input type="text" id="eventText" placeholder="Event description">
        <button class="retro-btn" onclick="addEvent()">Add</button>
      </div>
      <div id="eventList"></div>
      <button class="retro-btn" onclick="backToTerminal()">← Back</button>
    </div>
  </div>

  <!-- Log Page -->
  <div id="logPage" class="retro-page">
    <div class="retro-box">
      <div class="section-title">[ VISITOR LOGS ]</div>
      <div id="logList">Fetching visitor IP...</div>
      <button class="retro-btn" onclick="backToTerminal()">← Back</button>
    </div>
  </div>

  <!-- Nuclear Page -->
  <div id="nuclearPage" class="retro-page">
    <div class="retro-box">
      <div class="section-title">[ NUCLEAR REACTOR SIM ]</div>
      <div class="status">
        Core Temp: <span id="coreTemp">300</span>°C<br>
        Power Output: <span id="powerOutput">500</span> MW<br>
        Control Rods: <span id="rodLevel">50</span>%<br>
        Coolant Flow: <span id="coolantFlow">50</span>%
      </div>
      <div>
        <button class="retro-btn" onclick="adjustRods(-10)">Insert Rods</button>
        <button class="retro-btn" onclick="adjustRods(10)">Withdraw Rods</button>
        <button class="retro-btn" onclick="adjustCoolant(-10)">Decrease Coolant</button>
        <button class="retro-btn" onclick="adjustCoolant(10)">Increase Coolant</button>
      </div>
      <button class="retro-btn" onclick="backToTerminal()">← Back</button>
    </div>
  </div>

  <script>
    const loadingScreen = document.getElementById('loadingScreen');
    const terminal = document.getElementById('terminal');
    const designPage = document.getElementById('designPage');
    const portalPage = document.getElementById('portalPage');
    const logPage = document.getElementById('logPage');
    const nuclearPage = document.getElementById('nuclearPage');

    const commandInput = document.createElement('input');
    commandInput.type = 'text';
    commandInput.id = 'commandInput';

    let termText = "";
    let prompt = "\nSynthOS> ";

    function showTerminal() {
      loadingScreen.style.display = 'none';
      terminal.style.display = 'block';
      termText = "Welcome to SynthwaveOS v3.0\nType 'help' for commands.\n";
      terminal.innerHTML = termText + prompt;
      terminal.appendChild(commandInput);
      commandInput.focus();
    }
    setTimeout(showTerminal, 4000);

    // Command Handler
    commandInput.addEventListener('keydown', (e) => {
      if (e.key === "Enter") {
        const cmd = commandInput.value.trim().toLowerCase();
        termText += prompt + cmd + "\n";
        handleCommand(cmd);
        terminal.innerHTML = termText + prompt;
        terminal.appendChild(commandInput);
        commandInput.value = "";
        terminal.scrollTop = terminal.scrollHeight;
      }
    });

    function handleCommand(cmd){
      if (cmd === "help") {
        termText += "Available commands:\n- design\n- portal\n- log\n- nuclear\n- clear\n";
      } else if (cmd === "design") {
        terminal.style.display = 'none';
        designPage.style.display = 'flex';
        loadRandom();
      } else if (cmd === "portal") {
        terminal.style.display = 'none';
        portalPage.style.display = 'flex';
        renderEvents();
      } else if (cmd === "log") {
        terminal.style.display = 'none';
        logPage.style.display = 'flex';
        fetchIP();
      } else if (cmd === "nuclear") {
        terminal.style.display = 'none';
        nuclearPage.style.display = 'flex';
      } else if (cmd === "clear") {
        termText = "";
      } else if (cmd) {
        termText += cmd + ": command not found\n";
      }
    }

    // Back function
    function backToTerminal() {
      designPage.style.display = 'none';
      portalPage.style.display = 'none';
      logPage.style.display = 'none';
      nuclearPage.style.display = 'none';
      terminal.style.display = 'block';
      commandInput.focus();
    }

    // ===== DESIGN PAGE =====
    const photo = document.getElementById('photo');
    function loadRandom(){
      const url = `https://source.unsplash.com/random/1600x900/?interior,retro&sig=${Date.now()}`;
      photo.src = url;
      photo.onerror = ()=> {
        photo.src = `https://picsum.photos/1600/900?random=${Date.now()}`;
      };
    }
    const radio = document.getElementById('radio');
    const timeLeft = document.getElementById('timeLeft');
    function startMusic(){
      if (radio.paused) {
        radio.muted = false;
        radio.play().then(()=> timeLeft.textContent = "Now playing: Synphaera Radio")
          .catch(err => console.log("Play error:", err));
      }
    }
    document.body.addEventListener('click', startMusic, { once: true });
    document.getElementById('newBtn').addEventListener('click', ()=> { loadRandom(); startMusic(); });

    // ===== PORTAL PAGE (Persistent Events) =====
    const eventList = document.getElementById('eventList');
    function addEvent(){
      const date = document.getElementById('eventDate').value;
      const text = document.getElementById('eventText').value;
      if (!date || !text) return;
      let events = JSON.parse(localStorage.getItem("events")||"[]");
      events.push({date,text});
      localStorage.setItem("events",JSON.stringify(events));
      renderEvents();
      document.getElementById('eventText').value = "";
    }
    function renderEvents(){
      eventList.innerHTML = "";
      let events = JSON.parse(localStorage.getItem("events")||"[]");
      events.forEach(ev=>{
        const entry = document.createElement('div');
        entry.textContent = `[${ev.date}] ${ev.text}`;
        eventList.appendChild(entry);
      });
    }

    // ===== LOG PAGE (Persistent IP Log) =====
    const logList = document.getElementById('logList');
    function fetchIP(){
      fetch('https://api64.ipify.org?format=json')
        .then(res => res.json())
        .then(data => {
          let logs = JSON.parse(localStorage.getItem("visitorIPs")||"[]");
          logs.push(data.ip);
          localStorage.setItem("visitorIPs", JSON.stringify(logs));
          renderIPs();
        }).catch(()=> logList.textContent = "Unable to fetch IP.");
    }
    function renderIPs(){
      logList.innerHTML = "";
      let logs = JSON.parse(localStorage.getItem("visitorIPs")||"[]");
      logs.forEach((ip,i)=> {
        const line = document.createElement('div');
        line.textContent = `${i+1}. ${ip}`;
        logList.appendChild(line);
      });
    }

    // ===== Nuclear Simulation =====
    let coreTemp = 300, powerOutput = 500, rodLevel = 50, coolantFlow = 50;
    function updateReactor(){
      // Physics-ish simulation
      coreTemp += (100-rodLevel)/20 - coolantFlow/25;
      if (coreTemp < 200) coreTemp = 200;
      if (coreTemp > 2000) coreTemp = 2000;
      powerOutput = Math.max(0, Math.floor((100-rodLevel) * (coreTemp/300)));
      document.getElementById("coreTemp").textContent = coreTemp.toFixed(0);
      document.getElementById("powerOutput").textContent = powerOutput;
      document.getElementById("rodLevel").textContent = rodLevel;
      document.getElementById("coolantFlow").textContent = coolantFlow;
    }
    function adjustRods(amount){
      rodLevel = Math.min(100, Math.max(0, rodLevel+amount));
      updateReactor();
    }
    function adjustCoolant(amount){
      coolantFlow = Math.min(100, Math.max(0, coolantFlow+amount));
      updateReactor();
    }
    setInterval(updateReactor, 1000);
  </script>
</body>
</html>
